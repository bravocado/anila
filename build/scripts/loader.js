/*!
 * @overview RSVP - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE
 * @version   3.0.13
 */
(function(){"use strict";function t(t,e){for(var n=0,r=t.length;r>n;n++)if(t[n]===e)return n;return-1}function e(t){var e=t._promiseCallbacks;return e||(e=t._promiseCallbacks={}),e}function n(t,e){return"onerror"===t?void W.on("error",e):2!==arguments.length?W[t]:void(W[t]=e)}function r(t){return"function"==typeof t||"object"==typeof t&&null!==t}function o(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function u(){}function a(){}function s(t){try{return t.then}catch(e){return ue.error=e,ue}}function c(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function f(t,e,n){W.async(function(t){var r=!1,o=c(n,e,function(n){r||(r=!0,e!==n?h(t,n):d(t,n))},function(e){r||(r=!0,v(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,v(t,o))},t)}function l(t,e){e._state===oe?d(t,e._result):t._state===ie?v(t,e._result):_(e,void 0,function(n){e!==n?h(t,n):d(t,n)},function(e){v(t,e)})}function p(t,e){if(e.constructor===t.constructor)l(t,e);else{var n=s(e);n===ue?v(t,ue.error):void 0===n?d(t,e):o(n)?f(t,e,n):d(t,e)}}function h(t,e){t===e?d(t,e):r(e)?p(t,e):d(t,e)}function y(t){t._onerror&&t._onerror(t._result),m(t)}function d(t,e){t._state===re&&(t._result=e,t._state=oe,0===t._subscribers.length?W.instrument&&ne("fulfilled",t):W.async(m,t))}function v(t,e){t._state===re&&(t._state=ie,t._result=e,W.async(y,t))}function _(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+oe]=n,o[i+ie]=r,0===i&&t._state&&W.async(m,t)}function m(t){var e=t._subscribers,n=t._state;if(W.instrument&&ne(n===oe?"fulfilled":"rejected",t),0!==e.length){for(var r,o,i=t._result,u=0;u<e.length;u+=3)r=e[u],o=e[u+n],r?b(n,r,o,i):o(i);t._subscribers.length=0}}function g(){this.error=null}function w(t,e){try{return t(e)}catch(n){return ae.error=n,ae}}function b(t,e,n,r){var i=o(n),u,a,s,c;if(i){if(u=w(n,r),u===ae?(c=!0,a=u.error,u=null):s=!0,e===u)return void v(e,new TypeError("A promises callback cannot return that same promise."))}else u=r,s=!0;e._state!==re||(i&&s?h(e,u):c?v(e,a):t===oe?d(e,u):t===ie&&v(e,u))}function k(t,e){try{e(function r(e){h(t,e)},function o(e){v(t,e)})}catch(n){v(t,n)}}function E(t,e,n){return t===oe?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function S(t,e,n,r){this._instanceConstructor=t,this.promise=new t(a,r),this._abortOnReject=n,this._validateInput(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._init(),0===this.length?d(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&d(this.promise,this._result))):v(this.promise,this._validationError())}function A(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function T(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function j(t,e){this._id=ye++,this._label=e,this._state=void 0,this._result=void 0,this._subscribers=[],W.instrument&&ne("created",this),a!==t&&(o(t)||A(),this instanceof j||T(),k(this,t))}function x(){this.value=void 0}function C(t){try{return t.then}catch(e){return ve.value=e,ve}}function O(t,e,n){try{t.apply(e,n)}catch(r){return ve.value=r,ve}}function R(t,e){for(var n={},r,o,i=t.length,u=new Array(i),a=0;i>a;a++)u[a]=t[a];for(o=0;o<e.length;o++)r=e[o],n[r]=u[o+1];return n}function I(t){for(var e=t.length,n=new Array(e-1),r=1;e>r;r++)n[r-1]=t[r];return n}function P(t,e){return{then:function(n,r){return t.call(e,n,r)}}}function N(t,e,n,r){var o=O(n,r,e);return o===ve&&v(t,o.value),t}function M(t,e,n,r){return de.all(e).then(function(e){var o=O(n,r,e);return o===ve&&v(t,o.value),t})}function q(t){return t&&"object"==typeof t?t.constructor===de?!0:C(t):!1}function V(t,e,n){this._superConstructor(t,e,!1,n)}function D(t,e,n){this._superConstructor(t,e,!0,n)}function H(t,e,n){this._superConstructor(t,e,!1,n)}function U(){return function(){process.nextTick(G)}}function K(){var t=0,e=new Ne(G),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function Y(){var t=new MessageChannel;return t.port1.onmessage=G,function(){t.port2.postMessage(0)}}function J(){return function(){setTimeout(G,1)}}function G(){for(var t=0;Re>t;t+=2){var e=qe[t],n=qe[t+1];e(n),qe[t]=void 0,qe[t+1]=void 0}Re=0}function B(t,e){W.async(t,e)}function F(){W.on.apply(W,arguments)}function L(){W.off.apply(W,arguments)}var Q={mixin:function(t){return t.on=this.on,t.off=this.off,t.trigger=this.trigger,t._promiseCallbacks=void 0,t},on:function(n,r){var o=e(this),i;i=o[n],i||(i=o[n]=[]),-1===t(i,r)&&i.push(r)},off:function(n,r){var o=e(this),i,u;return r?(i=o[n],u=t(i,r),void(-1!==u&&i.splice(u,1))):void(o[n]=[])},trigger:function(t,n){var r=e(this),o,i;if(o=r[t])for(var u=0;u<o.length;u++)(i=o[u])(n)}},W={instrument:!1};Q.mixin(W);var X;X=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var z=X,Z=Date.now||function(){return(new Date).getTime()},te=Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return u.prototype=t,new u},ee=[],ne=function Ye(t,e,n){1===ee.push({name:t,payload:{guid:e._guidKey+e._id,eventName:t,detail:e._result,childGuid:n&&e._guidKey+n._id,label:e._label,timeStamp:Z(),stack:new Error(e._label).stack}})&&setTimeout(function(){for(var t,e=0;e<ee.length;e++)t=ee[e],W.trigger(t.name,t.payload);ee.length=0},50)},re=void 0,oe=1,ie=2,ue=new g,ae=new g;S.prototype._validateInput=function(t){return z(t)},S.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},S.prototype._init=function(){this._result=new Array(this.length)};var se=S;S.prototype._enumerate=function(){for(var t=this.length,e=this.promise,n=this._input,r=0;e._state===re&&t>r;r++)this._eachEntry(n[r],r)},S.prototype._eachEntry=function(t,e){var n=this._instanceConstructor;i(t)?t.constructor===n&&t._state!==re?(t._onerror=null,this._settledAt(t._state,e,t._result)):this._willSettleAt(n.resolve(t),e):(this._remaining--,this._result[e]=this._makeResult(oe,e,t))},S.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===re&&(this._remaining--,this._abortOnReject&&t===ie?v(r,n):this._result[e]=this._makeResult(t,e,n)),0===this._remaining&&d(r,this._result)},S.prototype._makeResult=function(t,e,n){return n},S.prototype._willSettleAt=function(t,e){var n=this;_(t,void 0,function(t){n._settledAt(oe,e,t)},function(t){n._settledAt(ie,e,t)})};var ce=function Je(t,e){return new se(this,t,!0,e).promise},fe=function Ge(t,e){function n(t){h(i,t)}function r(t){v(i,t)}var o=this,i=new o(a,e);if(!z(t))return v(i,new TypeError("You must pass an array to race.")),i;for(var u=t.length,s=0;i._state===re&&u>s;s++)_(o.resolve(t[s]),void 0,n,r);return i},le=function Be(t,e){var n=this;if(t&&"object"==typeof t&&t.constructor===n)return t;var r=new n(a,e);return h(r,t),r},pe=function Fe(t,e){var n=this,r=new n(a,e);return v(r,t),r},he="rsvp_"+Z()+"-",ye=0,de=j;j.cast=le,j.all=ce,j.race=fe,j.resolve=le,j.reject=pe,j.prototype={constructor:j,_guidKey:he,_onerror:function(t){W.trigger("error",t)},then:function(t,e,n){var r=this,o=r._state;if(o===oe&&!t||o===ie&&!e)return W.instrument&&ne("chained",this,this),this;r._onerror=null;var i=new this.constructor(a,n),u=r._result;if(W.instrument&&ne("chained",r,i),o){var s=arguments[o-1];W.async(function(){b(o,i,s,u)})}else _(r,i,t,e);return i},"catch":function(t,e){return this.then(null,t,e)},"finally":function(t,e){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})},e)}};var ve=new x,_e=new x,me=function Le(t,e){var n=function(){for(var n=this,r=arguments.length,o=new Array(r+1),i,u=!1,s=0;r>s;++s){if(i=arguments[s],!u){if(u=q(i),u===_e){var c=new de(a);return v(c,_e.value),c}u&&u!==!0&&(i=P(u,i))}o[s]=i}var f=new de(a);return o[r]=function(t,n){t?v(f,t):void 0===e?h(f,n):e===!0?h(f,I(arguments)):z(e)?h(f,R(arguments,e)):h(f,n)},u?M(f,o,t,n):N(f,o,t,n)};return n.__proto__=t,n},ge=function Qe(t,e){return de.all(t,e)};V.prototype=te(se.prototype),V.prototype._superConstructor=se,V.prototype._makeResult=E,V.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var we=function We(t,e){return new V(de,t,e).promise},be=function Xe(t,e){return de.race(t,e)},ke=D;D.prototype=te(se.prototype),D.prototype._superConstructor=se,D.prototype._init=function(){this._result={}},D.prototype._validateInput=function(t){return t&&"object"==typeof t},D.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},D.prototype._enumerate=function(){var t=this.promise,e=this._input,n=[];for(var r in e)t._state===re&&e.hasOwnProperty(r)&&n.push({position:r,entry:e[r]});var o=n.length;this._remaining=o;for(var i,u=0;t._state===re&&o>u;u++)i=n[u],this._eachEntry(i.entry,i.position)};var Ee=function ze(t,e){return new ke(de,t,e).promise};H.prototype=te(ke.prototype),H.prototype._superConstructor=se,H.prototype._makeResult=E,H.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var Se=function Ze(t,e){return new H(de,t,e).promise},Ae=function $e(t){throw setTimeout(function(){throw t}),t},Te=function tn(t){var e={};return e.promise=new de(function(t,n){e.resolve=t,e.reject=n},t),e},je=function en(t,e,n){return de.all(t,n).then(function(t){if(!o(e))throw new TypeError("You must pass a function as map's second argument.");for(var r=t.length,i=new Array(r),u=0;r>u;u++)i[u]=e(t[u]);return de.all(i,n)})},xe=function nn(t,e){return de.resolve(t,e)},Ce=function rn(t,e){return de.reject(t,e)},Oe=function on(t,e,n){return de.all(t,n).then(function(t){if(!o(e))throw new TypeError("You must pass a function as filter's second argument.");for(var r=t.length,i=new Array(r),u=0;r>u;u++)i[u]=e(t[u]);return de.all(i,n).then(function(e){for(var n=new Array(r),o=0,i=0;r>i;i++)e[i]&&(n[o]=t[i],o++);return n.length=o,n})})},Re=0,Ie=function un(t,e){qe[Re]=t,qe[Re+1]=e,Re+=2,2===Re&&Ve()},Pe="undefined"!=typeof window?window:{},Ne=Pe.MutationObserver||Pe.WebKitMutationObserver,Me="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,qe=new Array(1e3),Ve;Ve="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?U():Ne?K():Me?Y():J(),W.async=Ie;var De=xe;if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var He=window.__PROMISE_INSTRUMENTATION__;n("instrument",!0);for(var Ue in He)He.hasOwnProperty(Ue)&&F(Ue,He[Ue])}var Ke={race:be,Promise:de,allSettled:we,hash:Ee,hashSettled:Se,denodeify:me,on:F,off:L,map:je,filter:Oe,resolve:xe,reject:Ce,all:ge,rethrow:Ae,defer:Te,EventTarget:Q,configure:n,async:B};"function"==typeof define&&define.amd?define(function(){return Ke}):"undefined"!=typeof module&&module.exports?module.exports=Ke:"undefined"!=typeof this&&(this.RSVP=Ke)}).call(this),function(t,e){"use strict";var n=e.head||e.getElementsByTagName("head")[0],r="basket-",o=5e3,i=function(t,e){try{return localStorage.setItem(r+t,JSON.stringify(e)),!0}catch(n){if(n.name.toUpperCase().indexOf("QUOTA")>=0){var o,u=[];for(o in localStorage)0===o.indexOf(r)&&u.push(JSON.parse(localStorage[o]));return u.length?(u.sort(function(t,e){return t.stamp-e.stamp}),basket.remove(u[0].key),i(t,e)):void 0}return}},u=function(t){var e=new RSVP.Promise(function(e,n){var r=new XMLHttpRequest;r.open("GET",t),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?e({content:r.responseText,type:r.getResponseHeader("content-type")}):n(new Error(r.statusText)))},setTimeout(function(){r.readyState<4&&r.abort()},basket.timeout),r.send()});return e},a=function(t){return u(t.url).then(function(e){var n=s(t,e);return t.skipCache||i(t.key,n),n})},s=function(t,e){var n=+new Date;return t.data=e.content,t.originalType=e.type,t.type=t.type||e.type,t.skipCache=t.skipCache||!1,t.stamp=n,t.expire=n+60*(t.expire||o)*60*1e3,t},c=function(t,e){return!t||t.expire-+new Date<0||e.unique!==t.unique||basket.isValidItem&&!basket.isValidItem(t,e)},f=function(t){var e,n,r;if(t.url)return t.key=t.key||t.url,e=basket.get(t.key),t.execute=t.execute!==!1,r=c(e,t),t.live||r?(t.unique&&(t.url+=(t.url.indexOf("?")>0?"&":"?")+"basket-unique="+t.unique),n=a(t),t.live&&!r&&(n=n.then(function(t){return t},function(){return e}))):(e.type=t.type||e.originalType,n=new RSVP.Promise(function(t){t(e)})),n},l=function(t){var r=e.createElement("script");r.defer=!0,r.text=t.data,n.appendChild(r)},p={"default":l},h=function(t){return t.type&&p[t.type]?p[t.type](t):p["default"](t)},y=function(t){t.map(function(t){return t.execute&&h(t),t})},d=function(){var t,e,n=[];for(t=0,e=arguments.length;e>t;t++)n.push(f(arguments[t]));return RSVP.all(n)},v=function(){var t=d.apply(null,arguments),e=this.then(function(){return t}).then(y);return e.thenRequire=v,e};t.basket={require:function(){var t=d.apply(null,arguments).then(y);return t.thenRequire=v,t},remove:function(t){return localStorage.removeItem(r+t),this},get:function(t){var e=localStorage.getItem(r+t);try{return JSON.parse(e||"false")}catch(n){return!1}},clear:function(t){var e,n,o=+new Date;for(e in localStorage)n=e.split(r)[1],n&&(!t||this.get(n).expire<=o)&&this.remove(n);return this},isValidItem:null,timeout:5e3,addHandler:function(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){p[t]=e})},removeHandler:function(t){basket.addHandler(t,void 0)}},basket.clear(!0)}(this,document);